" Common  things in all of my vimrc's
"  File in git:  ~/gits/settings/default_vimrc
set nocompatible
set nohls
set ignorecase
set noincsearch
set guioptions-=T
set guioptions-=m
set sw=4
set ts=4
set expandtab
set cindent
set laststatus=2
runtime macros/matchit.vim
syntax  on
:ca lcdb lcd %:p:h
" Requires pygments and clippaste.
:ca pyHTML !c:\python25\scripts\pygmentize -O full -l python -f html \| c:\hg\py\misc\clippaste.py -
:ca reHTML !c:\hg\py\misc\clippaste.py -

func! ReToClip()
    " Call VST
    :Vst
    " Wait for new window to pop up
    :sleep 1
    " Copy to clipboard
    :%!c:\hg_resin\py\misc\clippaste.py -
    " exit
    :q!
endfunc

" from:http://stackoverflow.com/questions/114431/fast-word-count-function-in-vim
" Add wordcount to statuline:

function! W0rdCount()
    " Making name a w0rd so not picked up in completion with setWordCountToTitle
    let s:old_status = v:statusmsg
    let position = getpos(".")
    exe "silent normal g\<c-g>"
    if v:statusmsg != '--No lines in buffer--'
        let s:word_count = str2nr(split(v:statusmsg)[11])
        let v:statusmsg = s:old_status
    end
    call setpos('.', position)
    return s:word_count
endfunction

function! WordCountToTitle()
    exec ":set statusline=wc:%{W0rdCount()}"
endfunction

let g:pyindent_open_paren = '&sw * 2'
let g:pyindent_nested_paren = '&sw'
let g:pyindent_continue = '&sw * 2'


set tags=tags;/

function! TitlePrefix(prefix)
    let  g:TitlePrefix=a:prefix
    :auto! BufEnter * let &titlestring = g:TitlePrefix."||".expand("%:p")
    let &titlestring = g:TitlePrefix."||".expand("%:p")
endfunction

" TPS crap.
" find number in a line of xml.
:cab only_number %s;.*>\(\d\+.\d\+\)<.*;\1;g
:cab to_excel  %s;\( \\|,\);\t;g

function! FixCallStacks()
    :%s;\[NLN\];\r;g
    :%s;\[TAB\];\t;g
endfunction

function! StripPerfCounterTags()
    %s;\(\\.*\)<.*>;\1;
    %s;<.*>;;
endfunction

function! FixMojiBake()
    " See charector under cursor -
    "   ga
    " Search for non unicode charecters
    " /[^\x00-\x7F]

    " Replace hypens
	:%s/\%x97/-/g
	:%s/\%x96/-/g

    " Replace smart quotes
	:%s/\%x93/"/g
	:%s/\%x94/"/g
    "

    " Replace apostrophe
	:%s/\%x92/'/g
    " Replace apostrophe in bear
	:%s/\%xe2\%x80/'/g
endfunction

function! FirstPersonToThirdPerson()

    " Trim the whitespace off the ends
    :%s;\s\+$;;

    " Add a period to the end if it's not there.
    :g!/\.$/s;$;.;

    " do a bunch of replaces.
    :%s;^I;You;
    :%s;\. ^I;You;g
    :%s; I ; you ;g
    :%s; am ; are ;g
    :%s; me\([ \.,$]\); you\1;g
    :%s; me\([ \.,$]\); you\1;g
    :%s; mine\([ \.,$]\); yours\1;g
    :%s;^Me ;You ;g
    :%s; myself\([ \.,$]\); yourself\1;g
    :%s; my ; your ;g
    :%s;^My ;Your ;g
    :%s;^\.$;
endfunction

":compiler build
" Make 2 or more spaces between words an error.
"match Error /\> \{2,}\</
"
autocmd FileType python set omnifunc=pythoncomplete#Complete
autocmd FileType python compiler pylint

" Replace content with return from wget.
"
:cab wg %!c:\bin_drop\wget --quiet --output-document -
" JS Beautify
"     https://coderwall.com/p/m2kp5q/invoke-js-beautify-in-vim
:cab jsb %!js-beautify -j -q -B -f -<CR>

"  Vundle setup
    " Instructions @  https://github.com/VundleVim/Vundle.vim/blob/master/README.md
    " git clone https://github.com/VundleVim/Vundle.vim %USERPROFILE%/vimfiles/bundle/vundle
    " MAC - $ git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
    filetype off
    set rtp+=~/vimfiles/bundle/Vundle
    set rtp+=~/.vim/bundle/Vundle.vim
    call vundle#begin()

    Bundle 'VundleVim/Vundle.vim'
    Bundle 'mattn/webapi-vim'
    Bundle 'tpope/vim-fugitive'
    Bundle 'Ron89/thesaurus_query.vim'
    "
    :noremap  <Leader>tr :ThesaurusQueryReplaceCurrentWord<CR>

    Bundle 'junegunn/limelight.vim'
    Bundle 'reedes/vim-pencil'
    Bundle 'junegunn/goyo.vim'

    Bundle 'leafgarland/typescript-vim'
    Bundle 'nathanaelkane/vim-indent-guides'
    Bundle 'mhinz/vim-startify'
    Bundle 'tpope/vim-surround'
    Bundle 'bling/vim-airline'
    Bundle 'chrisbra/csv.vim'
    Bundle 'altercation/vim-colors-solarized'
    Bundle 'vim-scripts/ZoomWin'
    " change font size \\++
    Bundle 'drmikehenry/vim-fontsize'


    " Markdown stuff
    " *******************************
    Bundle 'godlygeek/tabular'
    Bundle 'mzlogin/vim-markdown-toc'
    " :GenTocGFM
    " :UpdateToc

    Bundle 'plasticboy/vim-markdown'
    " :TOC - Generate a toc sidebar
    " ]] Next Header
    " [[ Prev Header
    Bundle 'tpope/vim-liquid'
    Bundle 'parkr/vim-jekyll'
    Bundle 'christoomey/vim-quicklink'

    Bundle 'elzr/vim-json'
    Bundle 'PProvost/vim-ps1'
    Bundle 'othree/javascript-libraries-syntax.vim'
    Bundle "pangloss/vim-javascript"
    Bundle "scrooloose/nerdtree"
    Bundle "rking/ag.vim"
    Bundle "OrangeT/vim-csharp.git"
    Bundle "lukaszkorecki/workflowish"
    Bundle "keith/swift.vim"
    " http://vimcolors.com/?page=11
    Bundle 'flazz/vim-colorschemes'
    Bundle 'dhruvasagar/vim-table-mode'
    Bundle 'atelierbram/vim-colors_atelier-schemes'
    " Comment \cc
    " Uncomment \cu
    Bundle 'scrooloose/nerdcommenter'

    " I use this instead of FZF or Ctrl-P
    Bundle 'Shougo/denite.nvim'

    " PymodeLintAuto
    Plugin 'python-mode/python-mode'

    Plugin 'kchmck/vim-coffee-script'
    Plugin 'aklt/plantuml-syntax'
    Plugin 'scrooloose/vim-slumlord'

    Plugin 'airblade/vim-gitgutter'
    " ]c -> Next hunk
    " ]c -> Prev hunk

    " Replace syntastic with ale
    " Bundle 'scrooloose/syntastic'
    Plugin 'w0rp/ale'

    " Ale for prose requires
    " write-good
    " prose-lint
    " vale
    Plugin 'danro/rename.vim'

    Plugin 'easymotion/vim-easymotion'
    " All of your Plugins must be added before the following line
call vundle#end()            " required


" Setup Unite
    :cab ls :Denite buffer
    :cab UFR :Denite -start-insert file file_mru directory_mru file_rec
    :nnoremap <C-P> :Denite file buffer file_mru directory_mru<cr>
    call denite#custom#map('insert', '<C-j>', '<denite:move_to_next_line>', 'noremap')
    call denite#custom#map('insert', '<C-n>', '<denite:move_to_next_line>', 'noremap')
    call denite#custom#map('insert', '<C-k>', '<denite:move_to_previous_line>', 'noremap')
    call denite#custom#map('insert', '<C-p>', '<denite:move_to_previous_line>', 'noremap')

" End Setup

filetype plugin indent on    " required

" Open XCode IDE - TBD make this per MAC Only
map ,x :exe "!xed -l " . line(".") . " %" <cr>

" Set font-size default to be a decent size.
if ( has("win32") || has("win64") || has("win16") )
    " TBD: Get smart about first run vs reload - but can do that later.
    let defaultFont="Consolas:h14"
    exec "set guifont=".defaultFont
endif
"
"WOFL Helpers
" HELP @ https://github.com/lukaszkorecki/workflowish"

func! OneNoteToWafl()
    " Tabs to spaces
    %s;\t;  ;g
    " Dots to *'s
    %s/\%u2022/*/g
    %s/\%u25cb/*/g
    %s/\%u00b7/*/g
endfunc

func! WriteOn()
    :Goyo
    :PencilSoft
    :Limelight
endfunc

func! WriteOff()
    :Goyo
    :PencilOff
    :Limelight!
endfunc


" TBD  Checkbox processing
"   add these only to markdown/html; checkboxopen, checkboxdone
"   Perhaps be clever and alternate between open and done like in OneNote via C-1
"
:iab _mc_ &#x2610;
:iab _mcd_ &#x2611;

func! MarkDownWordToLink()
    " cool yiw takes the word, and jumps you to the beginning of it.
    normal yiwi[ea](http://www.pa.com)
endfunc

func! JsToSingleLineClipBoard()
    " Creating a bookmarklet requires all JS to be on a single line.
    " Make it a single line and put it on global clipboard to paste into JS
    " console.

    " NOTE: when creating bookmarklets, you'll need to terminate all lines
    " with a ';' and only use inline comments, and end with void();

    " NOTE: when making it the bookmark, you need to start with javascript:

    " Join all to one line.
    exec ":%j"
    " Copy to Clipboard
    normal "*yy
    " Undo
    normal u
endfunc

if $TERM_PROGRAM =~ "iTerm"
    " No idea what these first two things are for - seem to be something
    " only needed in tmux (as opposed to just iTerm) - Groan, what a mess.
    " http://www.linuxquestions.org/questions/slackware-14/tip-24-bit-true-color-terminal-tmux-vim-4175582631/
    let &t_8f = "\<Esc>[38;2;%lu;%lu;%lum"
    let &t_8b = "\<Esc>[48;2;%lu;%lu;%lum"
    set termguicolors
endif

let &t_8f = "\<Esc>[38;2;%lu;%lu;%lum"
let &t_8b = "\<Esc>[48;2;%lu;%lu;%lum"
set termguicolors

" Other schemes I liek
"
if has ("gui-running")
    :colo Tomorrow-Night-Blue
else
    :colo darkblue
endif

" Remove trailing whitespace:
autocmd BufWritePre * :%s/\s\+$//e



" Markdown
"  ToC - Sidebar to navigate.
"  ][  - sibling prev
"  []  - sibling next
let g:vim_markdown_frontmatter = 1
set conceallevel=2
let g:vim_markdown_new_list_item_indent = 0
let g:vim_markdown_folding_level = 4
let g:vim_markdown_folding_level = 4

" Jekyll  - posts for use with JPost
" JVPost -  create jekyll post in new vertical split
let g:jekyll_post_extension = '.md'
    let g:jekyll_post_template =  [
      \ '---',
      \ 'layout: post',
      \ 'title: "JEKYLL_TITLE"',
      \ 'date: "JEKYLL_DATE"',
      \ 'tags:',
      \ '  - ',
      \ '---',
      \ ]

let g:jekyll_post_dirs = ['_posts', '../_posts','_drafts','../_drafts']

function! EscapeKey()
    " Do mappings for funny keyboard
    :inoremap ` <esc>
    :inoremap C-` `
    :cnoremap ` <esc>
    :cnoremap C-` `
endfunction

function! FixEscapeKey()
    :call EscapeKey()
endfunction

" vim:foldmethod=indent:
